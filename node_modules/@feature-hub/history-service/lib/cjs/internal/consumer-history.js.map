{"version":3,"file":"consumer-history.js","sourceRoot":"","sources":["../../../src/internal/consumer-history.ts"],"names":[],"mappings":"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","sourcesContent":["import * as history from 'history';\nimport {createHistoryPath} from './create-history-path';\nimport {createKey} from './create-key';\nimport {HistoryMultiplexer} from './history-multiplexer';\nimport {HistoryServiceContext} from './history-service-context';\n\nexport abstract class ConsumerHistory implements history.History {\n  public action: history.Action = history.Action.Pop;\n  public location: history.Location;\n\n  public constructor(\n    protected readonly context: HistoryServiceContext,\n    protected readonly historyKey: string,\n    protected readonly historyMultiplexer: HistoryMultiplexer,\n  ) {\n    const {pathname, search, hash, state, key} =\n      historyMultiplexer.getConsumerLocation(historyKey);\n\n    this.location = {\n      pathname: pathname.startsWith('/') ? pathname : `/${pathname}`,\n      search,\n      hash,\n      state,\n      key,\n    };\n\n    /**\n     * The methods of `history.History` must be bound explicitly, because\n     * components like `Link` from the `react-router-dom` package deconstruct\n     * methods like `push` and `replace` from the `history`.\n     */\n    this.push = this.push.bind(this);\n    this.replace = this.replace.bind(this);\n    this.go = this.go.bind(this);\n    this.back = this.back.bind(this);\n    this.forward = this.forward.bind(this);\n    this.block = this.block.bind(this);\n    this.createHref = this.createHref.bind(this);\n  }\n\n  public abstract listen(listener: history.Listener): () => void;\n\n  public push(to: history.To, state?: unknown): void {\n    this.location = this.createLocation(to, state);\n    this.historyMultiplexer.push(this.historyKey, this.location);\n    this.action = history.Action.Push;\n  }\n\n  public replace(to: history.To, state?: unknown): void {\n    this.location = this.createLocation(to, state);\n    this.historyMultiplexer.replace(this.historyKey, this.location);\n    this.action = history.Action.Replace;\n  }\n\n  public go(): void {\n    this.context.logger.warn('history.go() is not supported.');\n  }\n\n  public back(): void {\n    this.context.logger.warn('history.back() is not supported.');\n  }\n\n  public forward(): void {\n    this.context.logger.warn('history.forward() is not supported.');\n  }\n\n  public block(): () => void {\n    this.context.logger.warn('history.block() is not supported.');\n\n    return () => undefined;\n  }\n\n  public createHref(to: history.To): string {\n    return this.historyMultiplexer.createHref(\n      this.historyKey,\n      createHistoryPath(to, history.createPath(this.location)),\n    );\n  }\n\n  private createLocation(to: history.To, state?: unknown): history.Location {\n    return {\n      ...createHistoryPath(to, this.location.pathname),\n      state,\n      key: createKey(),\n    };\n  }\n}\n"]}