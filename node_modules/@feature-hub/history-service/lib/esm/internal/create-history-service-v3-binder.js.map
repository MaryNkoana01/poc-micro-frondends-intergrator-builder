{"version":3,"file":"create-history-service-v3-binder.js","sourceRoot":"","sources":["../../../src/internal/create-history-service-v3-binder.ts"],"names":[],"mappings":"AAGA,OAAO,EAAC,sBAAsB,EAAC,MAAM,4BAA4B,CAAC;AAIlE,OAAO,EAAC,qBAAqB,EAAC,MAAM,2BAA2B,CAAC;AAYhE,SAAS,sBAAsB,CAC7B,UAAkB,EAClB,eAAgC,EAChC,kBAAsC;IAEtC,OAAO;QACL,UAAU;QACV,OAAO,EAAE,eAAe;QACxB,WAAW,EAAE,kBAAkB,CAAC,WAAW;QAE3C,yCAAyC,EAAE,CAAC,GAAG,iBAAiB,EAAE,EAAE,CAClE,kBAAkB,CAAC,yCAAyC,CAC1D,GAAG,iBAAiB,CACrB;KACJ,CAAC;AACJ,CAAC;AAED,SAAS,oCAAoC,CAC3C,OAA8B,EAC9B,mBAAwC,EACxC,UAAkB;IAElB,MAAM,eAAe,GAAG,IAAI,sBAAsB,CAChD,OAAO,EACP,UAAU,EACV,mBAAmB,CAAC,yBAAyB,CAC9C,CAAC;IAEF,OAAO;QACL,cAAc,EAAE,sBAAsB,CACpC,UAAU,EACV,eAAe,EACf,mBAAmB,CAAC,yBAAyB,CAC9C;QAED,MAAM,EAAE,GAAG,EAAE;YACX,eAAe,CAAC,OAAO,EAAE,CAAC;QAC5B,CAAC;KACF,CAAC;AACJ,CAAC;AAED,SAAS,mCAAmC,CAC1C,OAA8B,EAC9B,mBAAwC,EACxC,UAAkB;IAElB,MAAM,eAAe,GAAG,IAAI,qBAAqB,CAC/C,OAAO,EACP,UAAU,EACV,mBAAmB,CAAC,wBAAwB,CAC7C,CAAC;IAEF,OAAO;QACL,cAAc,EAAE,sBAAsB,CACpC,UAAU,EACV,eAAe,EACf,mBAAmB,CAAC,wBAAwB,CAC7C;KACF,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,4BAA4B,CAC1C,OAA8B,EAC9B,mBAAwC,EACxC,OAA4C;IAE5C,MAAM,EAAC,IAAI,EAAE,aAAa,EAAC,GAAG,OAAO,CAAC;IAEtC,OAAO,CACL,UAAU,EACV,YAAY,EAC6B,EAAE;QAC3C,MAAM,UAAU,GAAG,aAAa,CAAC,EAAC,UAAU,EAAE,YAAY,EAAC,CAAC,CAAC;QAE7D,OAAO,IAAI,KAAK,SAAS;YACvB,CAAC,CAAC,oCAAoC,CAClC,OAAO,EACP,mBAAmB,EACnB,UAAU,CACX;YACH,CAAC,CAAC,mCAAmC,CACjC,OAAO,EACP,mBAAmB,EACnB,UAAU,CACX,CAAC;IACR,CAAC,CAAC;AACJ,CAAC","sourcesContent":["import {FeatureServiceBinder, FeatureServiceBinding} from '@feature-hub/core';\nimport * as history from 'history';\nimport {HistoryServiceV3} from '..';\nimport {BrowserConsumerHistory} from './browser-consumer-history';\nimport {HistoryMultiplexers} from './create-history-multiplexers';\nimport {HistoryMultiplexer} from './history-multiplexer';\nimport {HistoryServiceContext} from './history-service-context';\nimport {StaticConsumerHistory} from './static-consumer-history';\n\nexport interface CreateHistoryServiceV3BinderOptions {\n  readonly mode: 'browser' | 'static';\n  readonly getHistoryKey: (options: GetHistoryKeyOptions) => string;\n}\n\nexport interface GetHistoryKeyOptions {\n  readonly consumerId: string;\n  readonly consumerName?: string;\n}\n\nfunction createHistoryServiceV3(\n  historyKey: string,\n  consumerHistory: history.History,\n  historyMultiplexer: HistoryMultiplexer,\n): HistoryServiceV3 {\n  return {\n    historyKey,\n    history: consumerHistory,\n    rootHistory: historyMultiplexer.rootHistory,\n\n    createNewRootLocationForMultipleConsumers: (...consumerLocations) =>\n      historyMultiplexer.createNewRootLocationForMultipleConsumers(\n        ...consumerLocations,\n      ),\n  };\n}\n\nfunction createBrowserHistoryServiceV3Binding(\n  context: HistoryServiceContext,\n  historyMultiplexers: HistoryMultiplexers,\n  historyKey: string,\n): FeatureServiceBinding<HistoryServiceV3> {\n  const consumerHistory = new BrowserConsumerHistory(\n    context,\n    historyKey,\n    historyMultiplexers.browserHistoryMultiplexer,\n  );\n\n  return {\n    featureService: createHistoryServiceV3(\n      historyKey,\n      consumerHistory,\n      historyMultiplexers.browserHistoryMultiplexer,\n    ),\n\n    unbind: () => {\n      consumerHistory.destroy();\n    },\n  };\n}\n\nfunction createStaticHistoryServiceV3Binding(\n  context: HistoryServiceContext,\n  historyMultiplexers: HistoryMultiplexers,\n  consumerId: string,\n): FeatureServiceBinding<HistoryServiceV3> {\n  const consumerHistory = new StaticConsumerHistory(\n    context,\n    consumerId,\n    historyMultiplexers.staticHistoryMultiplexer,\n  );\n\n  return {\n    featureService: createHistoryServiceV3(\n      consumerId,\n      consumerHistory,\n      historyMultiplexers.staticHistoryMultiplexer,\n    ),\n  };\n}\n\nexport function createHistoryServiceV3Binder(\n  context: HistoryServiceContext,\n  historyMultiplexers: HistoryMultiplexers,\n  options: CreateHistoryServiceV3BinderOptions,\n): FeatureServiceBinder<HistoryServiceV3> {\n  const {mode, getHistoryKey} = options;\n\n  return (\n    consumerId,\n    consumerName,\n  ): FeatureServiceBinding<HistoryServiceV3> => {\n    const historyKey = getHistoryKey({consumerId, consumerName});\n\n    return mode === 'browser'\n      ? createBrowserHistoryServiceV3Binding(\n          context,\n          historyMultiplexers,\n          historyKey,\n        )\n      : createStaticHistoryServiceV3Binding(\n          context,\n          historyMultiplexers,\n          historyKey,\n        );\n  };\n}\n"]}