{"version":3,"file":"feature-app-manager.test.js","sourceRoot":"","sources":["../../../src/__tests__/feature-app-manager.test.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable:no-implicit-dependencies\n\nimport {\n  FeatureAppDefinition,\n  FeatureAppDescriptor,\n  FeatureAppManager,\n  FeatureServiceRegistry,\n  FeatureServicesBinding,\n  ModuleLoader,\n} from '..';\nimport {ExternalsValidator} from '../externals-validator';\nimport {FeatureAppModule} from '../internal/is-feature-app-module';\nimport {logger} from './logger';\n\ninterface MockFeatureServiceRegistry extends FeatureServiceRegistry {\n  registerFeatureServices: jest.Mock;\n  bindFeatureServices: jest.Mock;\n}\n\ndescribe('FeatureAppManager', () => {\n  let featureAppManager: FeatureAppManager;\n  let mockFeatureServiceRegistry: MockFeatureServiceRegistry;\n  let mockFeatureServicesBinding: FeatureServicesBinding;\n  let mockExternalsValidator: ExternalsValidator;\n  let mockFeatureServicesBindingUnbind: jest.Mock;\n  let mockModuleLoader: ModuleLoader;\n  let mockFeatureAppDefinition: FeatureAppDefinition<unknown>;\n  let mockFeatureAppModule: FeatureAppModule | undefined;\n  let mockFeatureAppCreate: jest.Mock;\n\n  beforeEach(() => {\n    mockFeatureServicesBindingUnbind = jest.fn();\n\n    mockFeatureServicesBinding = {\n      featureServices: {foo: {}},\n      unbind: mockFeatureServicesBindingUnbind,\n    };\n\n    mockFeatureServiceRegistry = {\n      registerFeatureServices: jest.fn(),\n      bindFeatureServices: jest.fn(() => mockFeatureServicesBinding),\n    } as MockFeatureServiceRegistry;\n\n    mockFeatureAppCreate = jest.fn(() => ({}));\n    mockFeatureAppDefinition = {create: mockFeatureAppCreate};\n    mockFeatureAppModule = {default: mockFeatureAppDefinition};\n    mockModuleLoader = jest.fn(async () => mockFeatureAppModule);\n    mockExternalsValidator = {\n      validate: jest.fn(),\n    } as Partial<ExternalsValidator> as ExternalsValidator;\n\n    featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n      logger,\n    });\n  });\n\n  describe('#getAsyncFeatureAppDefinition', () => {\n    beforeEach(() => {\n      featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n        logger,\n        moduleLoader: mockModuleLoader,\n      });\n    });\n\n    it('logs an info message when the Feature App module was loaded', async () => {\n      const asyncFeatureAppDefinition =\n        featureAppManager.getAsyncFeatureAppDefinition('/example.js');\n\n      expect(logger.info.mock.calls).toEqual([]);\n\n      await asyncFeatureAppDefinition.promise;\n\n      expect(logger.info.mock.calls).toEqual([\n        [\n          'The Feature App module at the url \"/example.js\" has been successfully loaded.',\n        ],\n      ]);\n    });\n\n    it('returns an async value for a Feature App definition', async () => {\n      const asyncFeatureAppDefinition =\n        featureAppManager.getAsyncFeatureAppDefinition('/example.js');\n\n      expect(asyncFeatureAppDefinition.value).toBeUndefined();\n      expect(asyncFeatureAppDefinition.error).toBeUndefined();\n\n      const featureAppDefinition = await asyncFeatureAppDefinition.promise;\n\n      expect(asyncFeatureAppDefinition.value).toBe(featureAppDefinition);\n      expect(asyncFeatureAppDefinition.error).toBeUndefined();\n      expect(featureAppDefinition).toBe(mockFeatureAppDefinition);\n    });\n\n    describe('with a custom module loader that handles multiple module types', () => {\n      let mockFeatureAppDefinitionA: FeatureAppDefinition<unknown>;\n      let mockFeatureAppDefinitionB: FeatureAppDefinition<unknown>;\n      let mockFeatureAppModuleA: FeatureAppModule | undefined;\n      let mockFeatureAppModuleB: FeatureAppModule | undefined;\n\n      beforeEach(() => {\n        mockFeatureAppDefinitionA = {create: mockFeatureAppCreate};\n        mockFeatureAppDefinitionB = {create: mockFeatureAppCreate};\n        mockFeatureAppModuleA = {default: mockFeatureAppDefinitionA};\n        mockFeatureAppModuleB = {default: mockFeatureAppDefinitionB};\n\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          logger,\n          moduleLoader: async (_url, moduleType) =>\n            moduleType === 'a'\n              ? mockFeatureAppModuleA\n              : moduleType === 'b'\n              ? mockFeatureAppModuleB\n              : undefined,\n        });\n      });\n\n      it('returns an async value containing the Feature App definition for the correct module type', async () => {\n        // Intentionally used for both module types to show that this is handled\n        // correctly by the Feature App Manager.\n        const url = '/example.js';\n\n        const asyncFeatureAppDefinitionA =\n          featureAppManager.getAsyncFeatureAppDefinition(url, 'a');\n\n        const featureAppDefinitionA = await asyncFeatureAppDefinitionA.promise;\n\n        expect(featureAppDefinitionA).toBe(mockFeatureAppDefinitionA);\n\n        const asyncFeatureAppDefinitionB =\n          featureAppManager.getAsyncFeatureAppDefinition(url, 'b');\n\n        const featureAppDefinitionB = await asyncFeatureAppDefinitionB.promise;\n\n        expect(featureAppDefinitionB).toBe(mockFeatureAppDefinitionB);\n      });\n\n      it('returns an async value containing an error for an missing module type', async () => {\n        const expectedError = new Error(\n          'The Feature App module at the url \"/example.js\" with no specific module type is invalid. A Feature App module must have a Feature App definition as default export. A Feature App definition is an object with at least a `create` method. Hint: The provided module loader expects an optional second parameter `moduleType`. It might need to be provided for this Feature App.',\n        );\n\n        await expect(\n          featureAppManager.getAsyncFeatureAppDefinition('/example.js').promise,\n        ).rejects.toEqual(expectedError);\n      });\n\n      it('returns an async value containing an error for an unknown module type', async () => {\n        const expectedError = new Error(\n          'The Feature App module at the url \"/example.js\" with the module type \"unknown\" is invalid. A Feature App module must have a Feature App definition as default export. A Feature App definition is an object with at least a `create` method.',\n        );\n\n        await expect(\n          featureAppManager.getAsyncFeatureAppDefinition(\n            '/example.js',\n            'unknown',\n          ).promise,\n        ).rejects.toEqual(expectedError);\n      });\n    });\n\n    describe.each([\n      undefined,\n      null,\n      {},\n      {default: {}},\n      {default: {create: 'notAFunction'}},\n    ])(\n      'when an invalid Feature App module (%o) has been loaded',\n      (invalidFeatureAppModule) => {\n        beforeEach(() => {\n          // tslint:disable-next-line:no-any\n          mockFeatureAppModule = invalidFeatureAppModule as any;\n        });\n\n        it('throws an error (and stores it on the async value)', async () => {\n          const expectedError = new Error(\n            'The Feature App module at the url \"/example.js\" with no specific module type is invalid. A Feature App module must have a Feature App definition as default export. A Feature App definition is an object with at least a `create` method.',\n          );\n\n          await expect(\n            featureAppManager.getAsyncFeatureAppDefinition('/example.js')\n              .promise,\n          ).rejects.toEqual(expectedError);\n\n          expect(\n            featureAppManager.getAsyncFeatureAppDefinition('/example.js').error,\n          ).toEqual(expectedError);\n        });\n      },\n    );\n\n    it('throws an error if no module loader was provided', () => {\n      featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n        logger,\n      });\n\n      expect(() =>\n        featureAppManager.getAsyncFeatureAppDefinition('/example.js'),\n      ).toThrowError(new Error('No module loader provided.'));\n    });\n\n    describe('for a known Feature App module url', () => {\n      it('returns the same async Feature App definition', () => {\n        const asyncFeatureAppDefinition =\n          featureAppManager.getAsyncFeatureAppDefinition('/example.js');\n\n        expect(\n          featureAppManager.getAsyncFeatureAppDefinition('/example.js'),\n        ).toBe(asyncFeatureAppDefinition);\n      });\n    });\n  });\n\n  describe('#createFeatureAppScope', () => {\n    it('creates a Feature App with a consumer environment using the Feature Service registry', () => {\n      const featureAppId = 'testId';\n      const config = 'testConfig';\n      const baseUrl = '/base';\n\n      featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n        logger,\n      });\n\n      featureAppManager.createFeatureAppScope(\n        featureAppId,\n        mockFeatureAppDefinition,\n        {baseUrl, config},\n      );\n\n      expect(mockFeatureServiceRegistry.bindFeatureServices.mock.calls).toEqual(\n        [[mockFeatureAppDefinition, featureAppId, undefined]],\n      );\n\n      const {featureServices} = mockFeatureServicesBinding;\n\n      expect(mockFeatureAppCreate.mock.calls).toEqual([\n        [{baseUrl, config, featureServices, featureAppId}],\n      ]);\n    });\n\n    describe('with a beforeCreate callback', () => {\n      it('calls the beforeCreate callback with the same env that is passed to create, prior to calling create', () => {\n        const featureAppId = 'testId';\n\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          logger,\n        });\n\n        let beforeCreateCalled = false;\n\n        const mockBeforeCreate = jest.fn(() => {\n          beforeCreateCalled = true;\n        });\n\n        expect.assertions(2);\n\n        mockFeatureAppCreate.mockImplementation(() => {\n          expect(beforeCreateCalled).toBe(true);\n\n          return {};\n        });\n\n        featureAppManager.createFeatureAppScope(\n          featureAppId,\n          mockFeatureAppDefinition,\n          {beforeCreate: mockBeforeCreate},\n        );\n\n        expect(mockBeforeCreate.mock.calls).toEqual(\n          mockFeatureAppCreate.mock.calls,\n        );\n      });\n\n      describe('that throws an error', () => {\n        it('throws the same error and unbinds the bound Feature Services', () => {\n          const mockError = new Error('mockError');\n\n          expect(() =>\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n              {\n                beforeCreate: () => {\n                  throw mockError;\n                },\n              },\n            ),\n          ).toThrowError(mockError);\n\n          expect(mockFeatureServicesBindingUnbind).toHaveBeenCalledTimes(1);\n        });\n      });\n    });\n\n    describe('with a done callback', () => {\n      it('passes the done callback as part of the env to the Feature App', () => {\n        const featureAppId = 'testId';\n\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          logger,\n        });\n\n        const mockDone = jest.fn();\n\n        featureAppManager.createFeatureAppScope(\n          featureAppId,\n          mockFeatureAppDefinition,\n          {done: mockDone},\n        );\n\n        const {featureServices} = mockFeatureServicesBinding;\n\n        expect(mockFeatureAppCreate.mock.calls).toEqual([\n          [{featureServices, featureAppId, done: mockDone}],\n        ]);\n      });\n    });\n\n    describe('with an onBind callback', () => {\n      it('calls the onBind callback successfully', () => {\n        const mockOnBind = jest.fn();\n        const featureAppId = 'testId';\n        const featureAppName = 'testName';\n\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          logger,\n          onBind: mockOnBind,\n        });\n\n        const parentFeatureApp: FeatureAppDescriptor = {\n          featureAppId: 'parentTestId',\n          featureAppName: 'parentTestName',\n        };\n\n        featureAppManager.createFeatureAppScope(\n          featureAppId,\n          mockFeatureAppDefinition,\n          {featureAppName, parentFeatureApp},\n        );\n\n        expect(mockOnBind.mock.calls).toEqual([\n          [\n            {\n              featureAppDefinition: mockFeatureAppDefinition,\n              featureAppId,\n              featureAppName,\n              parentFeatureApp,\n            },\n          ],\n        ]);\n      });\n\n      describe('that throws an error', () => {\n        it('does not throw but logs the error', () => {\n          const mockError = new Error('mockError');\n\n          featureAppManager = new FeatureAppManager(\n            mockFeatureServiceRegistry,\n            {\n              logger,\n              onBind: () => {\n                throw mockError;\n              },\n            },\n          );\n\n          expect(() =>\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n            ),\n          ).not.toThrow();\n\n          expect(logger.error.mock.calls).toEqual([\n            ['Failed to execute onBind callback.', mockError],\n          ]);\n        });\n      });\n    });\n\n    describe('with a featureAppName', () => {\n      it('passes the featureAppName as consumerName to bindFeatureServices', () => {\n        const featureAppId = 'testId';\n        const featureAppName = 'testName';\n\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          logger,\n        });\n\n        featureAppManager.createFeatureAppScope(\n          featureAppId,\n          mockFeatureAppDefinition,\n          {featureAppName},\n        );\n\n        expect(\n          mockFeatureServiceRegistry.bindFeatureServices.mock.calls,\n        ).toEqual([[mockFeatureAppDefinition, featureAppId, featureAppName]]);\n      });\n\n      it('creates a Feature App with a consumer environment that includes the featureAppName', () => {\n        const featureAppId = 'testId';\n        const featureAppName = 'testName';\n\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          logger,\n        });\n\n        featureAppManager.createFeatureAppScope(\n          featureAppId,\n          mockFeatureAppDefinition,\n          {featureAppName},\n        );\n\n        const {featureServices} = mockFeatureServicesBinding;\n\n        expect(mockFeatureAppCreate.mock.calls).toEqual([\n          [{featureServices, featureAppId, featureAppName}],\n        ]);\n      });\n    });\n\n    describe('without an ExternalsValidator provided to the FeatureAppManager', () => {\n      describe('with a Feature App definition that is declaring external dependencies', () => {\n        beforeEach(() => {\n          mockFeatureAppDefinition = {\n            ...mockFeatureAppDefinition,\n            dependencies: {\n              externals: {\n                react: '^16.0.0',\n              },\n            },\n          };\n        });\n\n        it(\"doesn't throw an error\", () => {\n          expect(() => {\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n            );\n          }).not.toThrowError();\n        });\n      });\n    });\n\n    describe('with an ExternalsValidator provided to the FeatureAppManager', () => {\n      beforeEach(() => {\n        featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n          externalsValidator: mockExternalsValidator,\n          logger,\n        });\n      });\n\n      describe('with a Feature App definition that is failing the externals validation', () => {\n        let mockError: Error;\n\n        beforeEach(() => {\n          mockError = new Error('mockError');\n\n          mockExternalsValidator.validate = jest.fn(() => {\n            throw mockError;\n          });\n\n          mockFeatureAppDefinition = {\n            ...mockFeatureAppDefinition,\n            dependencies: {\n              externals: {\n                react: '^16.0.0',\n              },\n            },\n          };\n        });\n\n        it('calls the provided ExternalsValidator with the defined externals', () => {\n          try {\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n            );\n          } catch {}\n\n          expect(mockExternalsValidator.validate).toHaveBeenCalledWith(\n            {react: '^16.0.0'},\n            'testId',\n          );\n        });\n\n        it('throws the validation error', () => {\n          expect(() => {\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n            );\n          }).toThrowError(mockError);\n        });\n      });\n\n      describe('with a Feature App definition that is not failing the externals validation', () => {\n        beforeEach(() => {\n          mockFeatureAppDefinition = {\n            ...mockFeatureAppDefinition,\n            dependencies: {\n              externals: {\n                react: '^16.0.0',\n              },\n            },\n          };\n        });\n\n        it('calls the provided ExternalsValidator with the defined externals', () => {\n          featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          );\n\n          expect(mockExternalsValidator.validate).toHaveBeenCalledWith(\n            {react: '^16.0.0'},\n            'testId',\n          );\n        });\n\n        it(\"doesn't throw an error\", () => {\n          expect(() => {\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n            );\n          }).not.toThrowError();\n        });\n      });\n\n      describe('with a Feature App definition that declares no externals', () => {\n        it('does not call the provided ExternalsValidator', () => {\n          featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          );\n\n          expect(mockExternalsValidator.validate).not.toHaveBeenCalled();\n        });\n\n        it(\"doesn't throw an error\", () => {\n          expect(() => {\n            featureAppManager.createFeatureAppScope(\n              'testId',\n              mockFeatureAppDefinition,\n            );\n          }).not.toThrowError();\n        });\n      });\n    });\n\n    describe('when bindFeatureServices throws an error', () => {\n      let mockError: Error;\n\n      beforeEach(() => {\n        mockError = new Error('mockError');\n\n        mockFeatureServiceRegistry.bindFeatureServices.mockImplementation(\n          () => {\n            throw mockError;\n          },\n        );\n      });\n\n      it('throws the same error', () => {\n        expect(() =>\n          featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          ),\n        ).toThrowError(mockError);\n      });\n    });\n\n    describe(\"when the FeatureApp's create method throws an error\", () => {\n      it('throws the same error and unbinds the bound Feature Services', () => {\n        const mockError = new Error('mockError');\n\n        mockFeatureAppCreate.mockImplementation(() => {\n          throw mockError;\n        });\n\n        expect(() =>\n          featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          ),\n        ).toThrowError(mockError);\n\n        expect(mockFeatureServicesBindingUnbind).toHaveBeenCalledTimes(1);\n      });\n    });\n\n    describe('with a Feature App definition with own Feature Service definitions', () => {\n      let featureServiceRegistryMethodCalls: string[];\n\n      beforeEach(() => {\n        featureServiceRegistryMethodCalls = [];\n\n        mockFeatureServiceRegistry.registerFeatureServices.mockImplementation(\n          () => {\n            featureServiceRegistryMethodCalls.push('registerFeatureServices');\n          },\n        );\n\n        mockFeatureServiceRegistry.bindFeatureServices.mockImplementation(\n          () => {\n            featureServiceRegistryMethodCalls.push('bindFeatureServices');\n\n            return mockFeatureServicesBinding;\n          },\n        );\n\n        mockFeatureAppDefinition = {\n          ...mockFeatureAppDefinition,\n          ownFeatureServiceDefinitions: [\n            {id: 'ownFeatureServiceId', create: jest.fn()},\n          ],\n        };\n      });\n\n      it(\"registers the Feature App's own Feature Services before binding its required Feature Services\", () => {\n        const featureAppId = 'testId';\n\n        featureAppManager.createFeatureAppScope(\n          featureAppId,\n          mockFeatureAppDefinition,\n        );\n\n        expect(\n          mockFeatureServiceRegistry.registerFeatureServices.mock.calls,\n        ).toEqual([\n          [mockFeatureAppDefinition.ownFeatureServiceDefinitions, featureAppId],\n        ]);\n\n        expect(\n          mockFeatureServiceRegistry.bindFeatureServices.mock.calls,\n        ).toEqual([[mockFeatureAppDefinition, featureAppId, undefined]]);\n\n        expect(featureServiceRegistryMethodCalls).toEqual([\n          'registerFeatureServices',\n          'bindFeatureServices',\n        ]);\n      });\n    });\n\n    describe('for a known Feature App definition', () => {\n      describe('with a beforeCreate callback', () => {\n        it('does not call the beforeCreate callback multiple times', () => {\n          const featureAppId = 'testId';\n\n          featureAppManager = new FeatureAppManager(\n            mockFeatureServiceRegistry,\n            {logger},\n          );\n\n          const mockBeforeCreate = jest.fn();\n\n          featureAppManager.createFeatureAppScope(\n            featureAppId,\n            mockFeatureAppDefinition,\n            {beforeCreate: mockBeforeCreate},\n          );\n\n          featureAppManager.createFeatureAppScope(\n            featureAppId,\n            mockFeatureAppDefinition,\n            {beforeCreate: mockBeforeCreate},\n          );\n\n          expect(mockBeforeCreate.mock.calls).toHaveLength(1);\n\n          expect(mockBeforeCreate.mock.calls).toEqual(\n            mockFeatureAppCreate.mock.calls,\n          );\n        });\n\n        describe('when release() is called on the Feature App scope', () => {\n          it('calls the beforeCreate callback again', () => {\n            const featureAppId = 'testId';\n\n            featureAppManager = new FeatureAppManager(\n              mockFeatureServiceRegistry,\n              {logger},\n            );\n\n            const mockBeforeCreate = jest.fn();\n\n            const featureAppScope = featureAppManager.createFeatureAppScope(\n              featureAppId,\n              mockFeatureAppDefinition,\n              {beforeCreate: mockBeforeCreate},\n            );\n\n            featureAppScope.release();\n\n            featureAppManager.createFeatureAppScope(\n              featureAppId,\n              mockFeatureAppDefinition,\n              {beforeCreate: mockBeforeCreate},\n            );\n\n            expect(mockBeforeCreate.mock.calls).toHaveLength(2);\n\n            expect(mockBeforeCreate.mock.calls).toEqual(\n              mockFeatureAppCreate.mock.calls,\n            );\n          });\n        });\n      });\n\n      it('logs an info message after creation', () => {\n        featureAppManager.createFeatureAppScope(\n          'testId',\n          mockFeatureAppDefinition,\n        );\n\n        expect(logger.info.mock.calls).toEqual([\n          [\n            'The Feature App with the ID \"testId\" has been successfully created.',\n          ],\n        ]);\n      });\n\n      it('returns a new Feature App scope containing the same Feature App instance', () => {\n        const featureAppScope1 = featureAppManager.createFeatureAppScope(\n          'testId',\n          mockFeatureAppDefinition,\n        );\n\n        const featureAppScope2 = featureAppManager.createFeatureAppScope(\n          'testId',\n          mockFeatureAppDefinition,\n        );\n\n        expect(featureAppScope2).not.toBe(featureAppScope1);\n        expect(featureAppScope2.featureApp).toBe(featureAppScope1.featureApp);\n      });\n    });\n\n    describe('#featureApp', () => {\n      it(\"is the Feature App that the Feature App definition's create returns\", () => {\n        const mockFeatureApp = {};\n\n        mockFeatureAppCreate.mockReturnValue(mockFeatureApp);\n\n        const featureAppScope = featureAppManager.createFeatureAppScope(\n          'testId',\n          mockFeatureAppDefinition,\n        );\n\n        expect(featureAppScope.featureApp).toBe(mockFeatureApp);\n      });\n    });\n\n    describe('#release', () => {\n      it('unbinds the bound Feature Services', () => {\n        const featureAppScope = featureAppManager.createFeatureAppScope(\n          'testId',\n          mockFeatureAppDefinition,\n        );\n\n        featureAppScope.release();\n\n        expect(mockFeatureServicesBindingUnbind).toHaveBeenCalledTimes(1);\n      });\n\n      describe('when unbind throws an error', () => {\n        it('a consecutive call of createFeatureAppScope does not return a scope with the old Feature App instance', () => {\n          const mockError = new Error('failed to unbind');\n\n          const featureAppScope1 = featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          );\n\n          mockFeatureServicesBindingUnbind.mockImplementation(() => {\n            throw mockError;\n          });\n\n          expect(() => {\n            featureAppScope1.release();\n          }).toThrowError(mockError);\n\n          const featureAppScope2 = featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          );\n\n          expect(featureAppScope1.featureApp).not.toBe(\n            featureAppScope2.featureApp,\n          );\n        });\n      });\n\n      describe('when createFeatureAppScope has been called two times', () => {\n        it('unbinds the bound Feature Services after the second scope has been released', () => {\n          const featureAppScope1 = featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          );\n\n          const featureAppScope2 = featureAppManager.createFeatureAppScope(\n            'testId',\n            mockFeatureAppDefinition,\n          );\n\n          featureAppScope1.release();\n          expect(mockFeatureServicesBindingUnbind).not.toHaveBeenCalled();\n\n          featureAppScope2.release();\n          expect(mockFeatureServicesBindingUnbind).toHaveBeenCalledTimes(1);\n        });\n      });\n\n      it('logs a warning when release is called multiple times', () => {\n        const featureAppScope = featureAppManager.createFeatureAppScope(\n          'testId',\n          mockFeatureAppDefinition,\n        );\n\n        featureAppScope.release();\n        featureAppScope.release();\n\n        expect(logger.warn.mock.calls).toEqual([\n          [\n            'The Feature App with the ID \"testId\" has already been released for this scope.',\n          ],\n        ]);\n      });\n    });\n  });\n\n  describe('#preloadFeatureApp', () => {\n    beforeEach(() => {\n      featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n        moduleLoader: mockModuleLoader,\n        logger,\n      });\n    });\n\n    it('preloads a Feature App definition so that the scope is synchronously available', async () => {\n      await featureAppManager.preloadFeatureApp('/example.js');\n\n      const asyncFeatureAppDefinition =\n        featureAppManager.getAsyncFeatureAppDefinition('/example.js');\n\n      expect(asyncFeatureAppDefinition.value).toBe(mockFeatureAppDefinition);\n    });\n\n    it('throws an error if no module loader was provided', () => {\n      featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry, {\n        logger,\n      });\n\n      expect(() =>\n        featureAppManager.getAsyncFeatureAppDefinition('/example.js'),\n      ).toThrowError(new Error('No module loader provided.'));\n    });\n  });\n\n  describe('without a custom logger', () => {\n    let consoleInfoSpy: jest.SpyInstance;\n\n    beforeEach(() => {\n      consoleInfoSpy = jest.spyOn(console, 'info');\n      featureAppManager = new FeatureAppManager(mockFeatureServiceRegistry);\n    });\n\n    afterEach(() => {\n      consoleInfoSpy.mockRestore();\n    });\n\n    it('logs messages using the console', () => {\n      featureAppManager.createFeatureAppScope(\n        'testId',\n        mockFeatureAppDefinition,\n      );\n\n      expect(consoleInfoSpy.mock.calls).toEqual([\n        ['The Feature App with the ID \"testId\" has been successfully created.'],\n      ]);\n    });\n  });\n});\n"]}