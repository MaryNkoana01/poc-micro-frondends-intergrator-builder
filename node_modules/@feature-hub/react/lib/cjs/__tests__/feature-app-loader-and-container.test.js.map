{"version":3,"file":"feature-app-loader-and-container.test.js","sourceRoot":"","sources":["../../../src/__tests__/feature-app-loader-and-container.test.tsx"],"names":[],"mappings":";AAAA;;GAEG;;;;;AAEH,0CAA0C;AAE1C,4CAI2B;AAC3B,kDAA0B;AAC1B,8EAA+C;AAC/C,0BAA+D;AAG/D,QAAQ,CAAC,+DAA+D,EAAE,GAAG,EAAE;IAC7E,IAAI,qBAAwC,CAAC;IAC7C,IAAI,6BAAwE,CAAC;IAC7E,IAAI,YAAuB,CAAC;IAC5B,IAAI,eAAiC,CAAC;IAEtC,UAAU,CAAC,GAAG,EAAE;QACd,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QAC/C,YAAY,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;QAEzB,MAAM,aAAa,GAAkB,EAAC,QAAQ,EAAE,YAAY,EAAC,CAAC;QAE9D,MAAM,wBAAwB,GAAwC;YACpE,MAAM,EAAE,GAAG,EAAE,CAAC,aAAa;SAC5B,CAAC;QAEF,6BAA6B,GAAG,IAAI,iBAAU,CAC5C,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CACtB,UAAU,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC,CACpD,CACF,CAAC;QAEF,qBAAqB,GAAG;YACtB,4BAA4B,EAAE,GAAG,EAAE,CAAC,6BAA6B;YACjE,qBAAqB,EAAE,GAAG,EAAE,CAAC,CAAC;gBAC5B,UAAU,EAAE,aAAa;gBACzB,OAAO,EAAE,IAAI,CAAC,EAAE,EAAE;aACnB,CAAC;YACF,iBAAiB,EAAE,IAAI,CAAC,EAAE,EAAE;SACsB,CAAC;IACvD,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QAC/C,eAAe,CAAC,WAAW,EAAE,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,MAAM,2BAA2B,GAAG,CAClC,IAAqB,EACrB,mBAAsD,EACtD,EAAE,CACF,6BAAY,CAAC,MAAM,CACjB,8BAAC,6BAAyB,IACxB,KAAK,EAAE,EAAC,iBAAiB,EAAE,qBAAqB,EAAC,IAEhD,IAAI,CACqB,EAC5B,mBAAmB,CACpB,CAAC;IAEJ,QAAQ,CAAC,wDAAwD,EAAE,GAAG,EAAE;QACtE,QAAQ,CAAC,iCAAiC,EAAE,GAAG,EAAE;YAC/C,QAAQ,CAAC,uBAAuB,EAAE,GAAG,EAAE;gBACrC,EAAE,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;oBACrD,2BAA2B,CACzB,8BAAC,oBAAgB,IAAC,YAAY,EAAC,QAAQ,EAAC,GAAG,EAAC,YAAY,IACrD,CAAC,EAAC,cAAc,EAAC,EAAE,EAAE,CAAC,2CAAM,cAAc,CAAO,CACjC,EACnB,EAAC,cAAc,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,EAAC,CAC7B,CAAC;oBAEF,MAAM,6BAA6B,CAAC,OAAO,CAAC;oBAE5C,MAAM,CAAC,YAAY,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;gBAChD,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["/**\n * @jest-environment jsdom\n */\n\n// tslint:disable:no-implicit-dependencies\n\nimport {\n  AsyncValue,\n  FeatureAppDefinition,\n  FeatureAppManager,\n} from '@feature-hub/core';\nimport React from 'react';\nimport TestRenderer from 'react-test-renderer';\nimport {FeatureAppLoader, FeatureHubContextProvider} from '..';\nimport {DomFeatureApp} from '../feature-app-container';\n\ndescribe('FeatureAppLoader with an unmocked InternalFeatureAppContainer', () => {\n  let mockFeatureAppManager: FeatureAppManager;\n  let mockAsyncFeatureAppDefinition: AsyncValue<FeatureAppDefinition<unknown>>;\n  let mockAttachTo: jest.Mock;\n  let consoleErrorSpy: jest.SpyInstance;\n\n  beforeEach(() => {\n    consoleErrorSpy = jest.spyOn(console, 'error');\n    mockAttachTo = jest.fn();\n\n    const domFeatureApp: DomFeatureApp = {attachTo: mockAttachTo};\n\n    const mockFeatureAppDefinition: FeatureAppDefinition<DomFeatureApp> = {\n      create: () => domFeatureApp,\n    };\n\n    mockAsyncFeatureAppDefinition = new AsyncValue(\n      new Promise((resolve) =>\n        setTimeout(() => resolve(mockFeatureAppDefinition)),\n      ),\n    );\n\n    mockFeatureAppManager = {\n      getAsyncFeatureAppDefinition: () => mockAsyncFeatureAppDefinition,\n      createFeatureAppScope: () => ({\n        featureApp: domFeatureApp,\n        release: jest.fn(),\n      }),\n      preloadFeatureApp: jest.fn(),\n    } as Partial<FeatureAppManager> as FeatureAppManager;\n  });\n\n  afterEach(() => {\n    expect(consoleErrorSpy).not.toHaveBeenCalled();\n    consoleErrorSpy.mockRestore();\n  });\n\n  const renderWithFeatureHubContext = (\n    node: React.ReactNode,\n    testRendererOptions?: TestRenderer.TestRendererOptions,\n  ) =>\n    TestRenderer.create(\n      <FeatureHubContextProvider\n        value={{featureAppManager: mockFeatureAppManager}}\n      >\n        {node}\n      </FeatureHubContextProvider>,\n      testRendererOptions,\n    );\n\n  describe('when a Feature App definition is loaded asynchronously', () => {\n    describe('with a children render function', () => {\n      describe('and a DOM Feature App', () => {\n        it('calls attachTo of the DOM Feature App', async () => {\n          renderWithFeatureHubContext(\n            <FeatureAppLoader featureAppId=\"testId\" src=\"example.js\">\n              {({featureAppNode}) => <div>{featureAppNode}</div>}\n            </FeatureAppLoader>,\n            {createNodeMock: () => ({})},\n          );\n\n          await mockAsyncFeatureAppDefinition.promise;\n\n          expect(mockAttachTo).toHaveBeenCalledTimes(1);\n        });\n      });\n    });\n  });\n});\n"]}